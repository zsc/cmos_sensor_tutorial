# 第4章：像素架构演进

本章深入探讨CMOS图像传感器像素架构的演进历程，从最简单的无源像素到现代复杂的专用像素设计。我们将分析每种架构的工作原理、优缺点以及适用场景，帮助读者理解像素设计中的关键权衡因素。通过本章学习，您将掌握如何根据具体应用需求选择和优化像素架构。

## 4.1 无源像素传感器（PPS）

### 4.1.1 基本结构与原理

无源像素传感器（Passive Pixel Sensor, PPS）是最早的CMOS图像传感器架构，其设计理念源自于CCD的电荷转移机制，但采用了标准CMOS工艺实现。每个像素仅包含一个光电二极管和一个选择开关，这种极简设计在早期CMOS工艺节点下具有重要意义。

```
        列线（Column Line）
            |
            |
      ┌─────┴─────┐
      │           │
      │    SW     │ ← 行选择信号
      │           │
      └─────┬─────┘
            │
        ┌───┴───┐
        │       │
        │  PD   │ ← 光电二极管
        │       │
        └───────┘
            │
           GND
```

PPS的物理实现通常基于N+/P-sub结构，形成一个反偏PN结。在光照条件下，入射光子在耗尽区及其附近产生电子-空穴对。由于内建电场的作用，光生电子被收集到N+区域，而空穴则流向P型衬底。这个过程导致结电容上的电压发生变化，该变化量正比于入射光强度和积分时间。

工作原理可分为三个关键阶段：

1. **积分阶段**：光电二极管处于反偏状态，初始电压为复位电平（通常为VDD）。光生载流子不断累积，使得节点电压逐渐下降。积分时间内的电压变化量ΔV = Q_photo/C_pd，其中Q_photo是光生电荷量，C_pd是光电二极管的结电容。结电容大小取决于PN结面积和耗尽区宽度，典型值在5-50 fF范围内。

2. **读出阶段**：行选择开关导通，像素通过列线连接到外部读出电路。此时发生关键的电荷重分配过程：像素电容C_pd与列线寄生电容C_col形成分压器。由于C_col >> C_pd（通常C_col是C_pd的100-1000倍），信号严重衰减。实际输出信号仅为原始信号的C_pd/(C_pd + C_col)倍，这是PPS架构的根本性缺陷。

3. **复位阶段**：通过外部电路对光电二极管复位到初始电压。复位可以通过列线实现（软复位）或通过专门的复位线实现（硬复位）。复位的完全性直接影响下一帧的图像质量，不完全复位会导致图像残留。

### 4.1.2 信号读出分析

PPS的信号读出过程涉及复杂的电荷转移和电压重分配机制。理解这一过程对于认识PPS的局限性至关重要。

在理想情况下，光电二极管上的信号电压为：

```
V_pd = V_reset - Q_signal / C_pd
```

其中：
- V_reset：复位电压（典型值2.5-3.3V）
- Q_signal：积分期间累积的信号电荷（与光强和积分时间成正比）
- C_pd：光电二极管电容（包括结电容和寄生电容）

然而，实际读出时情况截然不同。当行选择开关导通瞬间，光电二极管通过开关晶体管连接到列线。列线具有显著的寄生电容C_col，主要来源包括：

1. **金属走线电容**：列线通常贯穿整个像素阵列，长度可达数毫米。以0.18μm工艺为例，金属线电容约0.2 fF/μm，一条5mm长的列线仅走线电容就达1 pF。

2. **交叉耦合电容**：列线与行线、电源线等其他金属层的交叉点产生耦合电容，每个交叉点贡献约0.1-0.5 fF。对于1920×1080阵列，累积效应显著。

3. **晶体管寄生电容**：每行的选择晶体管关断时，其漏极仍连接在列线上，贡献结电容。1000行的累积效应可达数百fF。

4. **ESD保护电路**：列线末端的ESD保护二极管增加额外的结电容，典型值50-200 fF。

总体而言，C_col通常在1-10 pF范围，是C_pd的100-1000倍。这导致严重的信号衰减：

```
电荷分享比：η = C_pd / (C_pd + C_col)
实际输出：V_out = V_reset - η × (Q_signal / C_pd)
```

以典型参数计算：C_pd = 10 fF，C_col = 1 pF，则η ≈ 0.01，信号衰减100倍！这意味着原本100 mV的信号变化在列线上仅表现为1 mV，极易被噪声淹没。

更糟糕的是，读出速度受RC时间常数限制：

```
τ = R_on × (C_pd + C_col)
```

其中R_on是选择开关的导通电阻（典型值1-10 kΩ）。对于C_col = 1 pF，R_on = 5 kΩ，时间常数τ = 5 ns。要达到99%稳定需要约5τ = 25 ns，这限制了最高读出速度。

信噪比（SNR）分析更揭示了PPS的根本缺陷。考虑主要噪声源：

1. **复位噪声（kTC噪声）**：σ_reset = √(kT × C_pd) ≈ 200 μV（室温下）
2. **列线热噪声**：由于大电容C_col，列线kTC噪声更大
3. **放大器噪声**：外部放大器的输入参考噪声直接叠加

由于信号衰减而噪声不衰减（甚至增加），SNR急剧恶化。假设原始SNR = 40 dB，经过100倍衰减后，有效SNR降至0 dB左右，图像质量无法接受。

### 4.1.3 优缺点分析

**优点的深入分析**：

1. **极高填充因子**：由于每个像素仅含一个晶体管，填充因子可达60-70%，这在早期小像素设计中极具优势。相比之下，同期的CCD像素填充因子通常仅30-40%。

2. **工艺简单性**：PPS可用标准数字CMOS工艺制造，无需CCD的特殊工艺步骤（如多晶硅电极、埋沟道等）。这大幅降低了制造成本，使CMOS传感器的商业化成为可能。

3. **功耗优势**：像素本身几乎不消耗功率，仅在读出时有瞬态电流。整个传感器的功耗主要来自外围电路，典型功耗比CCD低10-100倍。

4. **随机访问能力**：不同于CCD的串行读出，PPS支持真正的随机像素访问，可实现感兴趣区域（ROI）读出，这对某些应用极具价值。

**缺点的深入剖析**：

1. **信号衰减的级联效应**：100-1000倍的信号衰减不仅降低了信号幅度，更关键的是破坏了信噪比。这迫使设计者采用高增益、低噪声的外部放大器，增加了系统复杂度和成本。

2. **固定模式噪声（FPN）灾难**：每个像素的晶体管阈值电压存在工艺偏差（σ_Vth ≈ 5-10 mV），这些偏差直接反映在输出信号中。由于缺乏像素内增益，FPN无法在像素级消除，需要复杂的片外校准。

3. **动态范围受限**：下限受噪声限制（读出噪声等效>100 e⁻），上限受光电二极管容量限制（典型<50,000 e⁻），导致动态范围通常<50 dB，远低于人眼的>120 dB。

4. **读出速度瓶颈**：大的RC时间常数限制了行读出速度。对于Full HD（1920×1080）30fps视频，每行可用时间仅约15 μs，扣除稳定时间后，实际采样时间极短。

5. **缩放困难**：随着像素尺寸缩小，C_pd按面积缩放（∝L²），但C_col按长度缩放（∝L），导致信号衰减比η ∝ L，像素越小问题越严重。这是PPS架构最终被淘汰的根本原因。

## 4.2 3T有源像素传感器（3T-APS）

### 4.2.1 架构革新

3T有源像素传感器（Active Pixel Sensor, APS）的诞生标志着CMOS图像传感器的重大突破。1968年，Noble首次提出了有源像素概念，但直到1990年代初，随着CMOS工艺的成熟，Eric Fossum等人在JPL才实现了实用化的3T-APS。这一架构通过在每个像素内集成放大器，从根本上解决了PPS的信号衰减问题。

```
         VDD
          │
    ┌─────┴─────┐
    │    RST    │ ← 复位信号
    └─────┬─────┘
          │
      ┌───┴───┐
      │       │
      │  PD   │ ← 光电二极管（浮动扩散FD）
      │       │
      └───┬───┘
          │
    ┌─────┴─────┐
    │    SF     │ ← 源跟随器
    └─────┬─────┘
          │
    ┌─────┴─────┐
    │    SEL    │ ← 行选择
    └─────┬─────┘
          │
        列线
```

三个晶体管的设计考量：

1. **复位晶体管（RST）**：通常采用NMOS实现，将浮动扩散（FD）节点复位到VDD-Vth（软复位）或VDD（硬复位）。晶体管尺寸需要权衡：过小导致复位时间过长，过大增加寄生电容和泄漏。典型W/L比为0.5/0.35（μm），既保证快速复位又最小化对FD电容的贡献。复位晶体管的阈值电压变化直接影响FPN，因此需要careful的版图匹配设计。

2. **源跟随器（SF）**：作为像素内的第一级放大，SF的性能直接决定了图像质量。理想的源跟随器应具有单位增益和零偏移，但实际增益通常为0.7-0.9，取决于晶体管的跨导gm和负载电流。SF晶体管的尺寸优化涉及多个权衡：
   - 增大W/L提高跨导，改善增益和带宽
   - 但也增加了输入电容，降低转换增益
   - 1/f噪声与WL成反比，需要足够大的面积
   - 典型设计：W/L = 1.0/1.0 μm，在性能和面积间取得平衡

3. **行选择晶体管（SEL）**：控制像素与列线的连接，实现行选址功能。SEL可以放置在SF的源极（源极选择）或漏极（漏极选择）。源极选择的优势是关断时功耗为零，但开启时存在体效应；漏极选择避免了体效应，但需要持续的偏置电流。现代设计多采用源极选择以降低功耗。

### 4.2.2 工作时序与信号链分析

3T-APS的工作时序看似简单，但每个阶段都蕴含着精细的设计考量：

```
RST  ━━━┓    ┏━━━━━━━━━━━━━━━━
        ┗━━━━┛

SEL  ━━━━━━━━┓              ┏━━
             ┗━━━━━━━━━━━━━━┛

Vout ════════╗──────────────╗══
      复位电平         信号电平
      (V_rst)         (V_sig)
```

**复位阶段的深入分析**：

复位过程并非瞬时完成，而是遵循RC充电曲线。FD节点电压变化为：
```
V_FD(t) = V_DD - (V_DD - V_initial) × exp(-t/τ_rst)
```
其中τ_rst = R_on,rst × C_FD，R_on,rst是复位晶体管的导通电阻。

复位不完全会导致图像滞后（image lag）。定义复位效率为：
```
η_rst = (V_FD,final - V_FD,initial) / (V_DD - V_FD,initial)
```
要达到99.9%的复位效率，需要约7个时间常数，即t_rst > 7τ_rst。

软复位（RST晶体管工作在亚阈值区）引入kTC噪声，但硬复位（RST晶体管工作在线性区）可能导致热载流子注入，增加暗电流。现代设计通常采用脉冲复位或反馈复位来优化这一权衡。

**积分阶段的载流子动力学**：

积分期间，光生电子在FD节点累积，导致电压下降：
```
dV_FD/dt = -I_photo / C_FD = -(η × Φ × A_pd × q) / C_FD
```
其中：
- η：量子效率
- Φ：光子通量（photons/s/cm²）
- A_pd：光电二极管面积
- q：电子电荷

FD节点不仅收集光生电荷，还受到各种泄漏电流影响：
1. 暗电流：I_dark ∝ exp(-Eg/2kT)，强温度依赖性
2. 复位晶体管亚阈值泄漏：I_sub ∝ exp(V_gs/nV_T)
3. 隧穿电流：在先进工艺节点变得显著

**读出阶段的信号完整性**：

源跟随器将FD电压缓冲到列线，但过程中存在多种非理想效应：

1. **增益非线性**：由于体效应和沟道长度调制，SF增益随输入电压变化：
   ```
   A_SF = gm/(gm + gmb + gds + 1/R_load)
   ```
   其中gmb是体跨导，gds是输出电导。非线性会导致图像失真。

2. **带宽限制**：SF的3dB带宽为：
   ```
   f_3dB = gm / (2π × C_load)
   ```
   对于高分辨率传感器，C_load可达数pF，限制了读出速度。

3. **噪声注入**：SF贡献的噪声功率谱密度为：
   ```
   S_n = 4kT × γ × (2/3) / gm + K_f / (C_ox × W × L × f)
   ```
   第一项是热噪声，第二项是1/f噪声。

### 4.2.3 噪声特性的全面分析

3T像素的噪声性能是其最大的技术挑战，深入理解各噪声源的物理机制对优化设计至关重要。

**1. 复位噪声（kTC噪声）的物理本质**：

复位噪声源于热力学的基本原理。当复位晶体管导通时，FD节点通过有限电阻连接到电源，形成RC低通滤波器。根据Nyquist定理，电阻产生的热噪声经过电容积分后，在FD节点产生电压噪声：

```
<V²_n> = kT/C_fd
σ_reset = √(kT/C_fd)
```

以室温（T=300K）和C_fd=10fF为例：
```
σ_reset = √(1.38×10⁻²³ × 300 / 10×10⁻¹⁵) = 64 μV
```

转换为电子数：
```
N_reset = σ_reset × C_fd / q = 40 e⁻ rms
```

这是3T像素的fundamental噪声下限，无法通过电路技术消除，只能通过增大C_fd来降低，但这会牺牲转换增益。这个两难困境直接推动了4T像素和CDS技术的发展。

**2. 源跟随器噪声的多维度分析**：

源跟随器作为模拟缓冲器，引入多种噪声成分：

a) **热噪声（白噪声）**：
MOS晶体管沟道电阻的热涨落产生电流噪声，其功率谱密度为：
```
S_id = 4kT × γ × gm
```
其中γ是噪声因子（长沟道约2/3，短沟道可达1-2）。

折合到输入端的电压噪声：
```
S_vn = S_id / gm² = 4kT × γ / gm
```

积分带宽内的总噪声：
```
σ_sf_thermal = √(∫S_vn × df) = √(8kTγ/3gm × BW)
```

对于gm=100μS，BW=1MHz，噪声约50μV rms。

b) **1/f噪声（闪烁噪声）**：
由Si-SiO₂界面陷阱的随机捕获释放载流子引起，功率谱密度为：
```
S_vn_flicker = K_f / (C_ox × W × L × f)
```

K_f是工艺相关常数（NMOS约10⁻²⁴ V²·F）。1/f噪声在低频（<100kHz）占主导，对慢速读出影响显著。优化策略包括：
- 增大晶体管面积WL
- 采用PMOS源跟随器（K_f更小）
- 相关多采样（CMS）技术

c) **随机电报噪声（RTN）**：
单个界面陷阱的捕获释放导致离散的电流跳变，在小尺寸晶体管中变得显著。RTN幅度：
```
ΔRTN = q / (W × L × C_ox) × 1/√N
```
其中N是沟道载流子数。当像素缩小到亚微米尺度，RTN可达数百μV，成为图像质量的limiting factor。

**3. 固定模式噪声（FPN）的系统影响**：

FPN不同于时域随机噪声，它在空间上固定但随时间稳定，主要来源包括：

a) **阈值电压失配**：
由于掺杂涨落和线边粗糙度（LER），相邻晶体管的Vth存在偏差：
```
σ_Vth = A_Vth / √(W × L)
```
A_Vth是Pelgrom系数（典型5-10 mV·μm）。对于1μm²晶体管，σ_Vth ≈ 5-10 mV。

b) **增益失配**：
源跟随器增益的像素间偏差：
```
σ_gain = σ_gm / gm ≈ σ_Vth / (V_gs - V_th)
```
典型值1-2%，导致响应非均匀性（PRNU）。

c) **暗电流非均匀性（DSNU）**：
各像素暗电流的对数正态分布，标准偏差可达平均值的50-100%。

FPN的影响远超随机噪声，因为人眼对固定图案极其敏感。即使FPN仅为信号的0.5%，也会产生可见的条纹或斑点。3T像素缺乏片内FPN抑制能力，必须依赖：
- 片外数字校正（需要存储校正系数）
- 双采样技术（需要帧存储器）
- 工艺优化（成本高昂）

### 4.2.4 性能优化策略

**转换增益与动态范围的精细平衡**：

转换增益（Conversion Gain, CG）定义为单个电子产生的电压变化：
```
CG = q/C_fd [V/e⁻]
```

C_fd包含多个成分：
```
C_fd = C_pd + C_rst + C_sf + C_wire + C_parasitic
```

优化策略需要考虑complete的权衡关系：

1. **高转换增益路径**（低光优化）：
   - 最小化C_fd：使用minimum尺寸晶体管，优化布线
   - 典型实现：C_fd < 5fF，CG > 30μV/e⁻
   - 优势：读出噪声降至<5e⁻
   - 代价：满阱容量仅5000-10000 e⁻，动态范围<60dB

2. **大动态范围路径**（强光优化）：
   - 增大C_fd：添加显式电容或增大PD面积
   - 典型实现：C_fd > 20fF，CG < 10μV/e⁻
   - 优势：满阱容量>50000 e⁻，动态范围>70dB
   - 代价：读出噪声>20e⁻，低光性能差

3. **自适应方案**：
   一些先进设计采用可变转换增益，根据光照条件动态调整：
   - 双转换增益（DCG）：通过开关切换额外电容
   - 自动增益控制（AGC）：根据信号电平调整SF偏置

**源跟随器的多目标优化**：

SF设计涉及增益、带宽、噪声、功耗的四维优化：

1. **跨导最大化**：
   ```
   gm = √(2μ_n × C_ox × (W/L) × I_D)
   ```
   增大W/L和I_D提高gm，但增加功耗和面积。

2. **带宽优化**：
   ```
   BW = gm / (2π × C_load) = √(2μ_n × I_D / (W×L)) / (2π × C_load)
   ```
   存在最优W/L比，过大反而降低带宽。

3. **噪声最小化**：
   - 热噪声∝1/√gm，需要大gm
   - 1/f噪声∝1/(WL)，需要大面积
   - 折中方案：W/L ≈ 1-2，面积1-4 μm²

4. **功耗约束**：
   ```
   P_pixel = V_DD × I_bias
   ```
   对于百万像素传感器，即使每像素10μA也产生10W功耗，因此通常采用脉冲偏置或共享偏置策略。

## 4.3 4T像素与相关双采样

### 4.3.1 传输门的引入

4T像素通过增加传输门（TG）实现了钳位光电二极管（PPD）与浮动扩散（FD）的分离：

```
         VDD
          │
    ┌─────┴─────┐
    │    RST    │ 
    └─────┬─────┘
          │
          FD ← 浮动扩散
          │
    ┌─────┴─────┐
    │    TG     │ ← 传输门
    └─────┬─────┘
          │
      ┌───┴───┐
      │  PPD  │ ← 钳位光电二极管
      └───────┘
          │
    ┌─────┴─────┐
    │    SF     │
    └─────┬─────┘
          │
    ┌─────┴─────┐
    │    SEL    │
    └─────┬─────┘
          │
        列线
```

### 4.3.2 钳位光电二极管（PPD）优势

PPD的能带结构实现了完全电荷转移：

```
     TG关闭时              TG开启时
    ┌────────┐           ┌────────┐
    │   FD   │           │   FD   │
    └───┬────┘           └────────┘
        │ 势垒                 ▼ 电荷转移
    ┌───┴────┐           ┌────────┐
    │  PPD   │           │  PPD   │
    │ ●●●●●● │           │        │
    └────────┘           └────────┘
```

关键特性：
- **完全耗尽**：消除复位噪声
- **低暗电流**：表面钝化层抑制界面态
- **高量子效率**：优化的耗尽区深度

### 4.3.3 相关双采样（CDS）

4T像素的真CDS实现：

```
时序：
RST  ━━┓  ┏━━━━━━━━━━━━━━━
       ┗━━┛

TG   ━━━━━━━━━┓  ┏━━━━━━━
              ┗━━┛

采样  复位采样   信号采样
     ↓          ↓
Vout ═══╗═══════╗════════
        │       │
        └───────┘
         ΔV = 真实信号
```

CDS消除的噪声：
- kTC复位噪声：完全消除
- 源跟随器偏移：完全消除  
- 1/f噪声：大部分消除
- 列FPN：完全消除

### 4.3.4 4T像素的性能指标

**关键性能参数**：

1. **量子效率（QE）**：
   - 典型值：50-70%（绿光）
   - 取决于填充因子和PPD设计

2. **暗电流**：
   - <10 e⁻/s @ 室温
   - PPD表面钝化效果显著

3. **满阱容量**：
   - PPD：10,000-50,000 e⁻
   - 取决于像素尺寸

4. **转换增益**：
   - 典型值：50-200 μV/e⁻
   - 与FD电容成反比

5. **读出噪声**：
   - <2 e⁻（优化设计）
   - CDS效果关键

## 4.4 共享像素架构

### 4.4.1 2×2共享结构

为进一步缩小像素尺寸，共享像素架构应运而生：

```
    PPD1        PPD2
      │    TG1    │    TG2
      └─────┬─────┘
            │
           FD（共享）
            │
      ┌─────┴─────┐
      │  RST/SF   │
      │   /SEL    │
      └─────┬─────┘
            │
    PPD3    │    PPD4
      │    TG3    │    TG4
      └─────┴─────┘
```

晶体管数量优化：
- 2×2共享：7T/4像素 = 1.75T/像素
- 2×1共享：5T/2像素 = 2.5T/像素
- 4×1共享：7T/4像素 = 1.75T/像素

### 4.4.2 读出序列设计

2×2共享像素的优化读出序列：

```
步骤1: 复位FD
RST ━━┓  ┏━━━
     ┗━━┛

步骤2-5: 依次转移并读出每个PPD
TG1 ━━━━┓┏━━━━━━━━━━
       ┗┛
TG2 ━━━━━━━━┓┏━━━━━━━
           ┗┛
TG3 ━━━━━━━━━━━━┓┏━━━
               ┗┛
TG4 ━━━━━━━━━━━━━━━━┓┏
                   ┗┛
```

### 4.4.3 串扰分析

共享架构的串扰机制：

1. **电学串扰**：
   - FD节点共享导致的容性耦合
   - 影响程度：~0.1-1%

2. **光学串扰**：
   - 相邻PPD之间的光扩散
   - 取决于像素隔离结构

3. **电荷溢出**：
   - 强光下PPD饱和后的溢出
   - 需要溢出保护设计

### 4.4.4 设计权衡

**优点**：
- 更高的填充因子（减少晶体管数量）
- 更小的像素尺寸可能
- 降低功耗（共享偏置）

**缺点**：
- 复杂的时序控制
- 潜在的串扰增加
- FD电容增大，转换增益降低
- 非同时曝光（滚动快门伪影）

## 4.5 全局快门像素

### 4.5.1 全局快门原理

全局快门实现所有像素同时曝光：

```
    传统滚动快门              全局快门
    ┌─────────┐              ┌─────────┐
行1 │▓▓▓░░░░░░│          行1 │▓▓▓▓▓░░░░│
行2 │░▓▓▓░░░░░│          行2 │▓▓▓▓▓░░░░│
行3 │░░▓▓▓░░░░│    VS    行3 │▓▓▓▓▓░░░░│
行4 │░░░▓▓▓░░░│          行4 │▓▓▓▓▓░░░░│
    └─────────┘              └─────────┘
      时间 →                   时间 →
```

### 4.5.2 像素内存储节点

5T/6T全局快门像素结构：

```
         VDD
          │
    ┌─────┴─────┐
    │    RST    │
    └─────┬─────┘
          │
          FD
          │
    ┌─────┴─────┐
    │    TG2    │ ← 存储门
    └─────┬─────┘
          │
         MEM ← 存储节点
          │
    ┌─────┴─────┐
    │    TG1    │ ← 传输门
    └─────┬─────┘
          │
      ┌───┴───┐
      │  PPD  │
      └───────┘
```

工作流程：
1. 全局复位
2. 同时曝光（所有行）
3. 全局转移到存储节点
4. 逐行读出存储电荷

### 4.5.3 存储节点设计挑战

**关键设计参数**：

1. **存储电容**：
   - 需足够大以容纳满阱电荷
   - 但增大电容降低转换增益

2. **暗电流抑制**：
   - 存储期间的暗电流累积
   - 需要特殊的屏蔽结构

3. **寄生光敏感性（PLS）**：
   ```
   PLS = Q_parasitic / Q_signal × 100%
   ```
   - 目标：<0.1%
   - 需要金属遮光层

### 4.5.4 电压域vs电荷域

**电压域全局快门**：
- 存储节点保持电压信息
- 需要额外的采样保持电路
- 功耗较高但噪声性能好

**电荷域全局快门**：
- 直接存储电荷
- 结构简单但易受暗电流影响
- 适合短存储时间应用

## 4.6 特殊像素设计

### 4.6.1 高动态范围（HDR）像素

**横向溢出集成电容（LOFIC）**：

```
      主PPD
        │
    ┌───┴───┐
    │       │
    │  PPD  │──→ 溢出门 ──→ LOFIC
    │       │              （大电容）
    └───────┘
        │
       TG
```

工作原理：
- 低光：信号存储在PPD（高转换增益）
- 强光：溢出到LOFIC（低转换增益）
- 动态范围扩展：>120dB

**双转换增益（DCG）像素**：

```
         FD1（小电容）
          │
    ┌─────┴─────┐
    │    DCG    │ ← 增益切换
    └─────┬─────┘
          │
         FD2（大电容）
```

模式切换：
- 高增益模式：仅用FD1，低噪声
- 低增益模式：FD1+FD2，大满阱

### 4.6.2 时间飞行（ToF）像素

**单光子雪崩二极管（SPAD）**：

```
    ┌──────────┐
    │  Quench  │ ← 淬灭电路
    └────┬─────┘
         │
    ┌────┴────┐
    │  SPAD   │ ← 工作在盖革模式
    └─────────┘
         │
    V_bias > V_breakdown
```

关键特性：
- 单光子灵敏度
- 时间分辨率：<100ps
- 暗计数率：<100 Hz
- 光子探测效率：>30%

**电流辅助光子解调（CAPD）**：

```
    调制光 ↓
    ┌───────┐
    │  PPD  │
    └───┬───┘
        │
    ┌───┴───┐
    │ Drift │ ← 漂移场调制
    └───┬───┘
      ／  ＼
    FD_A  FD_B
```

相位测量：
```
φ = arctan((C-D)/(A-B))
```
其中A,B,C,D为四个相位的采样值

### 4.6.3 偏振传感像素

**线栅偏振器集成**：

```
   0°   45°   90°  135° ← 偏振角度
  ┌───┬───┬───┬───┐
  │ ║ │ ／ │ ═ │ ＼ │ ← 金属线栅
  ├───┼───┼───┼───┤
  │PPD│PPD│PPD│PPD│
  └───┴───┴───┴───┘
```

斯托克斯参数计算：
```
S0 = I0 + I90           # 总强度
S1 = I0 - I90           # 水平/垂直偏振
S2 = I45 - I135         # 对角偏振
```

偏振度：
```
DoLP = √(S1² + S2²) / S0
```

### 4.6.4 事件驱动像素

**动态视觉传感器（DVS）**：

```
    ┌──────────┐
    │  光电流   │
    └────┬─────┘
         │
    ┌────┴────┐
    │  Log    │ ← 对数转换
    └────┬────┘
         │
    ┌────┴────┐
    │  Diff   │ ← 时间微分
    └────┬────┘
         │
    ┌────┴────┐
    │Threshold│ ← 阈值比较
    └────┬────┘
         │
      Event
```

事件生成条件：
```
|Δlog(I)| > θ → 产生事件
```

优势：
- 高时间分辨率（μs级）
- 高动态范围（>120dB）
- 低数据率（仅传输变化）
- 低功耗（事件驱动）

## 本章小结

像素架构的演进反映了CMOS图像传感器技术的不断进步：

1. **PPS→3T-APS**：解决了信号衰减问题，引入像素内放大
2. **3T→4T**：通过PPD和CDS彻底消除复位噪声，大幅提升图像质量
3. **独立→共享**：优化像素面积利用率，实现更小像素尺寸
4. **滚动→全局快门**：消除运动伪影，适应高速成像需求
5. **单一→专用功能**：HDR、ToF、偏振等特殊应用推动像素创新

**关键设计权衡**：
- 填充因子 vs 功能复杂度
- 转换增益 vs 满阱容量
- 噪声性能 vs 像素尺寸
- 帧率 vs 功耗
- 通用性 vs 专用优化

**核心性能指标**：
- 量子效率：光电转换效率的度量
- 读出噪声：决定低光性能
- 满阱容量：决定动态范围上限
- 暗电流：影响长曝光性能
- 转换增益：信号放大能力

## 练习题

### 基础题

**4.1** 计算题：一个4T像素的浮动扩散节点电容为10fF，满阱容量为20,000个电子。计算：
a) 转换增益（μV/e⁻）
b) 满阱时的电压摆幅
c) 复位噪声（e⁻ rms）

<details>
<summary>答案</summary>

a) 转换增益 CG = q/C_fd = 1.6×10⁻¹⁹/10×10⁻¹⁵ = 16 μV/e⁻

b) 电压摆幅 V_swing = FWC × CG = 20,000 × 16×10⁻⁶ = 0.32V

c) 复位噪声 N_reset = √(kTC_fd/q²) = √(1.38×10⁻²³×300×10×10⁻¹⁵)/(1.6×10⁻¹⁹) = 4.0 e⁻ rms
</details>

**4.2** 分析题：比较3T和4T像素架构，列出各自的主要噪声源，并说明4T像素如何消除复位噪声。

<details>
<summary>答案</summary>

3T像素噪声源：
- 复位噪声（kTC）：无法消除，典型20-50 e⁻
- 源跟随器热噪声
- 1/f噪声
- 固定模式噪声（FPN）

4T像素噪声源：
- 源跟随器热噪声
- 残余1/f噪声（CDS后）
- 暗电流散粒噪声

4T消除复位噪声机制：
1. PPD完全耗尽转移，每次转移后PPD电位固定
2. CDS采样复位电平和信号电平的差值
3. 复位噪声在两次采样中相同，相减后消除
</details>

**4.3** 设计题：为2×2共享像素架构设计读出时序，要求实现真CDS。画出RST、TG1-4、采样信号的时序图。

<details>
<summary>答案</summary>

```
RST  ━┓┏━━━┓┏━━━┓┏━━━┓┏━━━┓┏━━━
     ┗┛   ┗┛   ┗┛   ┗┛   ┗┛

TG1  ━━━━━━┓┏━━━━━━━━━━━━━━━━━
          ┗┛

TG2  ━━━━━━━━━━━┓┏━━━━━━━━━━━━
              ┗┛

TG3  ━━━━━━━━━━━━━━━┓┏━━━━━━━━
                  ┗┛

TG4  ━━━━━━━━━━━━━━━━━━━┓┏━━━━
                      ┗┛

SHR  ━━┓┏━━━┓┏━━━┓┏━━━┓┏━━━┓┏━
      ┗┛   ┗┛   ┗┛   ┗┛   ┗┛

SHS  ━━━━━━━┓┏━━━┓┏━━━┓┏━━━┓┏━
           ┗┛   ┗┛   ┗┛   ┗┛

     R1 S1 R2 S2 R3 S3 R4 S4
```

关键点：
- 每个像素独立复位和采样
- 复位采样在TG脉冲前
- 信号采样在TG脉冲后
- 保证CDS时间间隔一致
</details>

### 挑战题

**4.4** 优化题：设计一个HDR像素，要求动态范围>120dB，像素尺寸2.8μm。提出至少两种方案并比较优缺点。

<details>
<summary>答案</summary>

方案1：双转换增益（DCG）
- 结构：标准4T + 额外FD电容切换开关
- 高增益模式：80dB DR（低光）
- 低增益模式：80dB DR（强光）
- 组合DR：>130dB
- 优点：单次曝光，无运动伪影
- 缺点：额外晶体管，填充因子降低

方案2：横向溢出（LOFIC）
- 结构：PPD + 溢出门 + 大存储电容
- PPD范围：80dB
- LOFIC范围：60dB
- 总DR：>120dB
- 优点：连续响应，结构相对简单
- 缺点：两个转换增益的匹配校准

方案3：子帧HDR
- 短曝光：1ms，捕获高光
- 长曝光：100ms，捕获暗部
- 合成DR：>120dB
- 优点：使用标准4T像素
- 缺点：运动伪影，帧率降低

推荐：2.8μm像素采用DCG方案，平衡性能和复杂度
</details>

**4.5** 分析题：全局快门像素的寄生光敏感性（PLS）来源于哪些因素？如何优化设计将PLS降至0.01%以下？

<details>
<summary>答案</summary>

PLS来源：
1. 存储节点的直接光照
2. 串扰导致的光生载流子扩散
3. 金属层间隙的光泄漏
4. 衬底反射光

优化方案：

结构优化：
- 多层金属遮光（至少3层）
- 优化金属覆盖率>99.9%
- 存储节点深埋设计
- 加入光吸收层

电学优化：
- 存储节点周围加保护环
- 优化势阱设计防止电荷扩散
- 缩短存储时间（<1ms）

工艺优化：
- 深沟槽隔离（DTI）
- 背照式结构配合遮光层
- 抗反射涂层减少杂散光

验证方法：
- 强光直射测试（100klux）
- 不同波长PLS表征
- 温度依赖性测试
</details>

**4.6** 系统题：设计一个面向自动驾驶应用的像素架构，需要同时支持：高动态范围（>120dB）、全局快门、940nm近红外增强。给出像素结构和关键设计参数。

<details>
<summary>答案</summary>

像素架构：带电压域存储的双增益全局快门

结构设计：
```
      厚PPD（NIR优化）
           │
      ┌────┴────┐
      │   TG1   │
      └────┬────┘
           │
      存储电容C1
           │
      ┌────┴────┐
      │   TG2   │
      └────┬────┘
           │
         FD1/FD2（DCG）
           │
      SF + 采样保持
```

关键参数：
1. PPD设计：
   - 深度>5μm（940nm吸收）
   - 量子效率@940nm >30%
   - 满阱容量>30ke⁻

2. 全局快门：
   - 电压域存储降低PLS
   - 存储时间<5ms
   - PLS<0.05%

3. HDR实现：
   - 双转换增益
   - 高增益：0.1-1000 lux
   - 低增益：1000-100000 lux
   - 组合DR>120dB

4. 像素尺寸：
   - 目标：4.2μm
   - 填充因子>40%

5. 帧率：
   - 60fps@全局快门
   - 读出噪声<2e⁻@高增益

特殊优化：
- 940nm带通滤光片集成
- 温度补偿电路（-40~85°C）
- 冗余像素设计提高可靠性
</details>

**4.7** 开放题：展望未来5-10年，像素架构可能出现哪些革命性创新？考虑AI集成、量子成像、生物启发等前沿方向。

<details>
<summary>答案</summary>

可能的革命性创新：

1. **神经形态像素**
   - 像素内集成神经元电路
   - 实时特征提取（边缘、运动）
   - 稀疏编码输出
   - 功耗降低100倍

2. **量子像素**
   - 单光子计数能力
   - 量子纠缠成像
   - 超分辨率突破衍射极限
   - 量子加密图像传输

3. **计算像素**
   - 像素内CNN卷积运算
   - 可编程像素功能
   - 自适应曝光控制
   - 压缩感知集成

4. **生物启发设计**
   - 仿视网膜分层处理
   - 局部适应性增益
   - 色觉恒常性实现
   - 极化视觉集成

5. **3D堆叠像素**
   - 感光层/存储层/计算层垂直集成
   - 像素内存算一体
   - 超高填充因子（>90%）
   - 多光谱同时采集

6. **自修复像素**
   - 缺陷自动检测
   - 冗余电路切换
   - 老化补偿
   - 10年以上寿命

关键使能技术：
- 先进制程（<7nm）
- 新材料（钙钛矿、量子点）
- 异质集成
- AI协同设计
</details>

## 常见陷阱与错误

### 设计陷阱

1. **转换增益过度优化**
   - 错误：盲目减小FD电容追求高转换增益
   - 后果：满阱容量严重不足，动态范围受限
   - 正解：平衡转换增益和满阱容量，典型CG×FWC≈1V

2. **共享像素的FD电容忽视**
   - 错误：未考虑多个TG连接增加的寄生电容
   - 后果：转换增益显著低于预期
   - 正解：仔细提取寄生，优化布局减小连线

3. **全局快门的功耗低估**
   - 错误：忽略所有像素同时工作的峰值电流
   - 后果：电源压降，图像均匀性问题
   - 正解：加强电源网格，分区供电

4. **PPD势阱设计不当**
   - 错误：势阱过浅或梯度不足
   - 后果：电荷转移不完全，图像滞后
   - 正解：TCAD仿真优化，确保完全转移

### 测试盲点

1. **串扰测试不充分**
   - 常见遗漏：只测试相邻像素，忽略对角串扰
   - 正确方法：点光源扫描，完整串扰矩阵

2. **温度特性忽视**
   - 常见遗漏：只在室温测试
   - 正确方法：-40°C到85°C完整表征

3. **长期稳定性**
   - 常见遗漏：未进行老化测试
   - 正确方法：加速老化，热循环测试

### 调试技巧

1. **FPN问题定位**
   - 列FPN：检查列级电路匹配
   - 行FPN：检查行驱动和电源
   - 像素FPN：工艺均匀性问题

2. **图像滞后诊断**
   - 测试方法：强光脉冲后的残像
   - 原因定位：PPD设计/TG驱动/时序

3. **噪声源分离**
   - 暗场测试：分离读出噪声
   - 不同增益：分离各级噪声贡献
   - 频谱分析：识别1/f和白噪声

## 最佳实践检查清单

### 像素设计审查

- [ ] **填充因子优化**
  - 光电二极管面积最大化
  - 晶体管尺寸合理
  - 金属走线优化

- [ ] **噪声预算分配**
  - 读出噪声<2e⁻（低光应用）
  - 暗电流<10e⁻/s（室温）
  - FPN<0.5%（PRNU）

- [ ] **动态范围设计**
  - 满阱容量满足要求
  - 转换增益合理
  - HDR方案选择恰当

- [ ] **串扰抑制**
  - 像素间隔离结构
  - 金属屏蔽层设计
  - 势阱优化防溢出

### 版图设计要点

- [ ] **对称性**
  - 关键器件匹配对称
  - 差分信号路径平衡
  - 热分布均匀

- [ ] **屏蔽与隔离**
  - 敏感节点屏蔽
  - 电源/地线隔离
  - 保护环设计

- [ ] **寄生最小化**
  - FD节点寄生电容
  - 关键路径RC延迟
  - 耦合路径识别

### 可制造性考虑

- [ ] **工艺兼容性**
  - 标准CMOS工艺
  - 特殊工艺步骤最少
  - 成本可控

- [ ] **良率因素**
  - 设计规则裕量
  - 工艺偏差容限
  - 冗余和修复机制

- [ ] **测试覆盖**
  - 内建自测试
  - 关键参数可测
  - 故障定位能力

### 系统集成检查

- [ ] **接口兼容**
  - 时序满足要求
  - 电平匹配
  - 驱动能力充足

- [ ] **功耗预算**
  - 静态功耗
  - 动态功耗
  - 待机模式

- [ ] **可靠性设计**
  - ESD保护
  - 闩锁预防
  - 热管理方案
