<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>第5章：读出电路设计</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="搜索..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">CMOS 图像传感器设计与制造教程</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第1章：半导体物理与光电效应</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第2章：MOS器件物理与CMOS工艺</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第3章：光电二极管与像素理论</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第4章：像素架构演进</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第5章：读出电路设计</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第6章：时序控制与接口电路</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第7章：噪声分析与优化</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第8章：图像质量优化</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第9章：功耗与性能优化</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第10章：专用传感器设计</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第11章：片上图像信号处理</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第12章：制造工艺与良率</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第13章：传感器表征与测试</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第14章：系统集成与调试</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第15章：案例研究与未来趋势</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="5">第5章：读出电路设计</h1>
<h2 id="_1">学习目标</h2>
<p>本章深入探讨CMOS图像传感器的信号读出电路设计，从像素输出的微弱模拟信号到最终的数字输出。读者将掌握：</p>
<ul>
<li>理解源跟随器缓冲和列放大器的设计权衡</li>
<li>掌握相关双采样（CDS）技术消除固定模式噪声的原理</li>
<li>熟悉各种列并行ADC架构的优缺点</li>
<li>深入理解斜坡ADC、SAR ADC和Σ-Δ ADC在图像传感器中的具体实现</li>
<li>学会分析读出链路的噪声贡献和优化方法</li>
</ul>
<p>读出电路是决定传感器性能的关键环节，直接影响噪声水平、动态范围、帧率和功耗。本章将从电路原理出发，结合实际设计案例，帮助读者建立完整的读出链路设计能力。</p>
<h2 id="51">5.1 源跟随器与列放大器</h2>
<h3 id="511">5.1.1 像素内源跟随器</h3>
<p>像素内的源跟随器（Source Follower, SF）是读出链路的第一级，将浮动扩散节点（FD）的高阻抗信号转换为低阻抗输出，驱动列线负载。作为像素与外部电路的接口，SF的设计直接影响整个传感器的噪声性能和动态响应。</p>
<p><strong>基本结构与工作原理</strong></p>
<p>源跟随器本质上是一个共漏极放大器，提供接近单位增益的电压缓冲。在4T像素中，SF晶体管的栅极连接到浮动扩散节点，源极通过选择晶体管连接到列线。</p>
<div class="codehilite"><pre><span></span><code><span class="n">VDD</span>
<span class="w"> </span><span class="o">|</span>
<span class="w"> </span><span class="err">├─</span><span class="o">[</span><span class="n">RST</span><span class="o">]</span><span class="err">──┐</span>
<span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="n">C_FD</span>

<span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="n">C_FD</span>
<span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="o">|</span>

<span class="w"> </span><span class="err">├─</span><span class="o">[</span><span class="n">TX</span><span class="o">]</span><span class="err">──</span><span class="n">PPD</span>
<span class="w"> </span><span class="o">|</span>
<span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="err">┌────┐</span>
<span class="w"> </span><span class="err">└───┤</span><span class="n">M_SF</span><span class="err">├──┬──</span><span class="w"> </span><span class="n">V_pix</span>
<span class="w">     </span><span class="err">└────┘</span><span class="w">  </span><span class="o">|</span>
<span class="w">            </span><span class="o">[</span><span class="n">SEL</span><span class="o">]</span>
<span class="w">              </span><span class="o">|</span>
<span class="w">            </span><span class="n">列线</span>
<span class="w">              </span><span class="o">|</span>
<span class="w">            </span><span class="n">I_bias</span>
</code></pre></div>

<p>浮动扩散节点具有极小的电容（通常10-30fF），任何直接连接都会因为负载电容而严重衰减信号。源跟随器通过其高输入阻抗（理论上无穷大）和低输出阻抗（1/g_m）实现阻抗变换。当选择晶体管导通时，SF晶体管与列底部的电流源形成源跟随器结构。</p>
<p>源跟随器的小信号分析揭示了其增益特性。考虑体效应和沟道长度调制，完整的电压增益表达式为：</p>
<div class="codehilite"><pre><span></span><code><span class="n">A_SF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_m</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="n">R_load</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g_m</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="n">R_load</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g_mb</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="n">R_load</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g_ds</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="n">R_load</span><span class="p">)</span>
</code></pre></div>

<p>其中：</p>
<ul>
<li>g_m 是主跨导</li>
<li>g_mb 是体效应跨导（背栅跨导）</li>
<li>g_ds 是输出电导（沟道长度调制）</li>
<li>R_load 是等效负载电阻（由偏置电流源的输出阻抗决定）</li>
</ul>
<p>在理想情况下，如果忽略体效应和沟道长度调制，且g_m × R_load &gt;&gt; 1，增益可简化为：</p>
<div class="codehilite"><pre><span></span><code><span class="n">A_SF</span><span class="w"> </span><span class="err">≈</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">g_m</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="n">R_load</span><span class="p">)</span>
</code></pre></div>

<p>实际设计中，由于体效应的存在，增益通常在0.85-0.95之间。体效应系数γ（典型值0.2-0.4）直接影响增益损失。</p>
<p><strong>设计考虑因素</strong></p>
<p>源跟随器的设计涉及多个相互制约的参数，需要在性能指标间进行精心权衡。每个设计决策都会在系统层面产生连锁反应，影响传感器的整体性能。理解这些权衡关系是优化读出链路的关键。</p>
<ol>
<li><strong>线性度与动态范围</strong></li>
</ol>
<p>SF必须工作在饱和区以保证良好的线性度。这要求源极电压始终满足饱和条件。晶体管从饱和区进入线性区会导致增益突变和谐波失真，在图像中表现为灰度压缩和色彩偏差。输出电压摆幅受到多重限制：</p>
<ul>
<li>上限：V_out,max = VDD - V_GS,SF = VDD - (V_th + V_ov)</li>
<li>下限：V_out,min = V_bias + V_DS,sat</li>
</ul>
<p>其中V_ov是过驱动电压，典型值200-300mV。过驱动电压不能太小，否则跨导降低，噪声增加；也不能太大，否则牺牲动态范围。V_DS,sat是电流源保持饱和所需的最小漏源电压，通常需要100-200mV的裕量。这些限制决定了传感器的动态范围上限。</p>
<p>在实际设计中，还需要考虑工艺角（Process Corner）的影响。快角（Fast Corner）下阈值电压降低，增大了动态范围但可能导致漏电流增加；慢角（Slow Corner）下阈值电压升高，压缩了动态范围。设计必须在所有工艺角下保证性能指标，这通常意味着需要额外的设计裕量。</p>
<p>为了最大化动态范围，设计者通常采用以下策略：</p>
<ul>
<li>使用低阈值电压工艺选项（但会增加漏电流）</li>
<li>优化偏置点，平衡上下摆幅</li>
<li>采用自适应偏置技术，根据信号幅度调节工作点</li>
</ul>
<p>线性度的另一个重要方面是跨导g_m的信号依赖性。当输入信号变化时，工作点偏移导致g_m变化，引入谐波失真。三阶截点（IP3）可以表征这种非线性：</p>
<div class="codehilite"><pre><span></span><code>IP3 ≈ √(2/3) × (V_ov)^(3/2) / √(I_D)
</code></pre></div>

<ol start="2">
<li><strong>噪声贡献与优化</strong></li>
</ol>
<p>源跟随器是读出链路的第一个有源级，其噪声直接叠加到信号上，无法通过后续处理消除。主要噪声源包括：</p>
<ul>
<li><strong>热噪声</strong>：由沟道电阻的随机热运动产生</li>
</ul>
<div class="codehilite"><pre><span></span><code>v_n,thermal^2 = 4kT × γ / g_m
</code></pre></div>

<div class="codehilite"><pre><span></span><code> 其中γ是噪声系数，长沟道器件γ≈2/3，短沟道器件γ可达1-2
</code></pre></div>

<ul>
<li><strong>1/f噪声（闪烁噪声）</strong>：由Si-SiO2界面陷阱引起</li>
</ul>
<div class="codehilite"><pre><span></span><code>v_n,flicker^2 = K_f / (C_ox × W × L × f)
</code></pre></div>

<div class="codehilite"><pre><span></span><code> K_f是工艺相关的闪烁噪声系数，NMOS典型值10^-24 V²·F
</code></pre></div>

<ul>
<li><strong>散粒噪声</strong>：由栅极漏电流引起（高级工艺节点显著）</li>
</ul>
<div class="codehilite"><pre><span></span><code>i_n,gate^2 = 2q × I_gate
</code></pre></div>

<p>总噪声功率谱密度为各分量之和。在典型读出频率（1-10MHz），1/f噪声和热噪声都很重要。转角频率f_c（1/f噪声与热噪声相等的频率）为：</p>
<div class="codehilite"><pre><span></span><code>f_c = K_f × g_m / (4kT × γ × C_ox × W × L)
</code></pre></div>

<p>增大晶体管面积可以降低1/f噪声，但会增加寄生电容，影响速度。</p>
<ol start="3">
<li><strong>速度与功耗权衡</strong></li>
</ol>
<p>源跟随器的响应速度决定了最大帧率，这是视频应用和高速成像的关键指标。速度限制来自两个方面：小信号建立时间和大信号压摆率。小信号带宽由输出节点的RC时间常数决定：</p>
<ul>
<li>带宽：BW = g_m / (2π × C_col)</li>
<li>建立时间（0.1%精度）：t_settle ≈ 7 × C_col / g_m</li>
<li>压摆率：SR = I_bias / C_col</li>
</ul>
<p>建立时间决定了像素值能否在分配的读出时间内稳定到所需精度。对于12位精度，需要建立到0.024%（1/4096），实际需要约9个时间常数。如果建立不充分，会导致图像拖尾和运动模糊。</p>
<p>列电容C_col是速度的主要限制因素，包括多个组成部分：</p>
<ul>
<li>列线寄生电容（主要贡献，正比于列长度）：对于2000行的传感器，可达10-20pF</li>
<li>所有像素的源极结电容之和：每个像素贡献几fF，累积效应显著</li>
<li>列底部电路输入电容：包括CDS采样电容、放大器输入电容等</li>
<li>交叉耦合电容：相邻列线的耦合，影响串扰</li>
</ul>
<p>列长度是影响速度的关键参数。现代高分辨率传感器采用多种技术缩短有效列长度：上下分区读出（将阵列分为上下两部分）、多通道并行输出（将列分组到不同输出通道）、片上数据压缩（减少输出数据量）。</p>
<p>提高速度的方法需要综合考虑系统影响：</p>
<ul>
<li>增加偏置电流（但增加功耗）：电流翻倍可使建立时间减半，但功耗也翻倍。需要根据应用场景动态调节。</li>
<li>增大SF晶体管尺寸（提高g_m，但增加自负载）：W/L增大提高跨导，但栅电容增加会部分抵消速度提升。存在最优尺寸。</li>
<li>采用列并行架构，缩短列长度：最有效的方法，但增加芯片面积和设计复杂度。</li>
<li>使用低电容互连技术：采用更高层金属、增加线间距、使用低k介质等。</li>
<li>源极负反馈补偿：加入小电感改善带宽，但实现困难。</li>
</ul>
<p>功耗是便携设备的关键约束，直接影响电池寿命和热管理：</p>
<ul>
<li>静态功耗：P_static = I_bias × VDD × N_columns</li>
<li>动态功耗：P_dynamic = f_pixel × C_col × V_swing²</li>
<li>总功耗：对于1920列、10μA偏置、3.3V电源，静态功耗达63mW</li>
</ul>
<p>现代设计采用多种节能技术，实现功耗与性能的动态平衡：</p>
<ul>
<li>行选通期间才开启偏置电流：非活动列的偏置电流关闭，可节省90%以上静态功耗</li>
<li>根据增益设置调节偏置电流：高ISO时增加电流改善噪声，低ISO时降低电流节能</li>
<li>多列共享偏置电流源（时分复用）：相邻列交替工作，共享偏置电路</li>
<li>自适应偏置：根据像素输出幅度动态调节，暗像素使用小电流，亮像素使用大电流</li>
<li>电源门控：完全关闭未使用区域的电源，消除漏电流</li>
</ul>
<h3 id="512">5.1.2 列级放大器设计</h3>
<p>列放大器提供额外增益，改善信噪比，并实现差分信号处理。在现代CMOS图像传感器中，列放大器不仅仅是简单的增益级，还承担着信号调理、噪声抑制和动态范围优化的重要功能。</p>
<p><strong>可编程增益放大器（PGA）架构</strong></p>
<p>可编程增益是适应宽动态范围场景的关键技术，相当于传统相机的ISO调节功能。通过在模拟域提供增益，可以充分利用ADC的量化范围，避免在暗场景下量化噪声主导。这种模拟增益优于数字增益的原因在于：模拟增益发生在ADC量化之前，不会放大量化噪声；而数字增益只是简单地放大已量化的信号，同时放大了量化误差。</p>
<p>在实际应用中，PGA必须在不同光照条件下快速切换增益。例如，从室内转到室外拍摄时，可能需要在几毫秒内从16×增益切换到1×增益。这要求PGA具有快速建立能力和低切换噪声。增益切换时的瞬态响应如果处理不当，会在视频中产生可见的闪烁或亮度跳变。</p>
<div class="codehilite"><pre><span></span><code>        R_f (可切换)
     ┌──/\/\/\──┐
     |          |
V_in─┴─┤-\      |
       |  &gt;─────┴─── V_out
    ┌──┤+/
    |
   R_in
    |
   GND
</code></pre></div>

<p>基本的反相放大器配置提供增益：G = 1 + R_f/R_in</p>
<p>实际实现中，反馈网络采用多种优化技术：</p>
<ol>
<li>
<p><strong>二进制权重电阻阵列</strong>：使用开关选择不同的反馈电阻组合，实现2^N种增益设置。电阻匹配精度直接影响增益精度。</p>
</li>
<li>
<p><strong>电容反馈网络</strong>：在开关电容电路中，用电容比实现精确增益。优势是不受绝对值偏差影响，只依赖于匹配精度。</p>
</li>
<li>
<p><strong>连续可调增益</strong>：使用MOS管工作在线性区作为可变电阻，通过控制栅压实现连续增益调节。适合自动增益控制（AGC）应用。</p>
</li>
</ol>
<p>增益切换策略需要考虑：</p>
<ul>
<li>切换瞬态：增益改变时的建立时间和过冲</li>
<li>噪声贡献：高增益下放大器噪声被放大</li>
<li>带宽变化：增益带宽积（GBW）恒定，高增益时带宽降低</li>
</ul>
<p>典型的增益档位设计（ISO感光度对应）：</p>
<ul>
<li>1×（ISO 100）：强光条件，最小噪声</li>
<li>2×（ISO 200）：室内正常照明</li>
<li>4×（ISO 400）：弱光环境</li>
<li>8×（ISO 800）：暗光拍摄</li>
<li>16×或更高：极暗条件，接受噪声增加</li>
</ul>
<p><strong>差分架构的实现与优化</strong></p>
<p>全差分架构是高性能传感器的标准选择，其优势远超单端设计：</p>
<div class="codehilite"><pre><span></span><code>差分输入级：
V_in+ ──┤\
         | &gt;─┬── V_out+
V_in- ──┤/   │
              │
        ┌─────┴─────┐
        │  共模反馈  │
        └───────────┘
              │
V_in+ ──┤\    │
         | &gt;──┴── V_out-
V_in- ──┤/
</code></pre></div>

<p>关键优势深入分析：</p>
<ol>
<li>
<p><strong>共模噪声抑制</strong>：电源噪声、衬底噪声、电磁干扰等共模信号被抑制。共模抑制比（CMRR）典型值60-80dB。</p>
</li>
<li>
<p><strong>电源抑制比（PSRR）提升</strong>：差分结构对电源变化不敏感，PSRR可达70-90dB，比单端提高20-30dB。</p>
</li>
<li>
<p><strong>输出摆幅加倍</strong>：相同电源电压下，差分输出摆幅是单端的两倍，提高3dB的动态范围。</p>
</li>
<li>
<p><strong>偶次谐波消除</strong>：差分信号的对称性自然消除偶次谐波失真，改善线性度。THD典型改善10-20dB。</p>
</li>
<li>
<p><strong>时钟馈通抑制</strong>：开关电容电路中，差分结构抵消时钟馈通和电荷注入效应。</p>
</li>
</ol>
<p>共模反馈（CMFB）电路是差分放大器的关键：</p>
<ul>
<li>连续时间CMFB：使用电阻分压检测共模电平</li>
<li>开关电容CMFB：利用电容平均实现，避免静态功耗</li>
<li>伪差分结构：两个独立单端放大器，简化设计但性能降低</li>
</ul>
<h3 id="513">5.1.3 噪声优化策略</h3>
<p>读出链路的噪声优化是提升传感器性能的核心任务。由于噪声源分布在不同位置，需要采用系统化的优化方法，在各个层级实施针对性的降噪技术。</p>
<p><strong>像素级优化技术</strong></p>
<p>像素内的噪声优化聚焦于源跟随器，这是最关键的噪声贡献者：</p>
<ol>
<li><strong>晶体管尺寸优化</strong></li>
</ol>
<p>增大SF晶体管面积是降低1/f噪声的直接方法，但需要权衡多个因素：</p>
<div class="codehilite"><pre><span></span><code>最优尺寸设计流程：

1. 1/f噪声约束：W×L &gt; K_f×BW/(4kT×γ×f_corner)
2. 热噪声约束：g_m &gt; 4kT×γ×BW/V_n,target²
3. 面积约束：W×L &lt; A_pixel × 填充因子限制
4. 速度约束：C_gs + C_gd &lt; C_max
</code></pre></div>

<p>典型设计选择W/L=2-5，绝对尺寸W=1-2μm，L=0.5-1μm。使用最小长度会增加短沟道效应和热噪声，但减少面积。折衷方案是使用1.5-2倍最小长度。</p>
<ol start="2">
<li><strong>偏置电流优化</strong></li>
</ol>
<p>偏置电流影响多个性能指标，需要动态优化：</p>
<div class="codehilite"><pre><span></span><code>噪声与偏置关系：

<span class="k">-</span> 热噪声 ∝ 1/√I_bias（通过g_m）
<span class="k">-</span> 建立时间 ∝ 1/I_bias
<span class="k">-</span> 功耗 ∝ I_bias
</code></pre></div>

<p>自适应偏置策略：</p>
<ul>
<li>强光模式：降低偏置电流，噪声不是限制因素</li>
<li>弱光模式：提高偏置电流，改善噪声性能</li>
<li>高速模式：最大偏置电流，优先保证带宽</li>
</ul>
<ol start="3">
<li><strong>埋沟MOSFET技术</strong></li>
</ol>
<p>埋沟（Buried Channel）MOSFET将导电沟道移离Si-SiO2界面，显著降低1/f噪声：</p>
<ul>
<li>传统表面沟道：载流子直接与界面陷阱作用，1/f噪声大</li>
<li>埋沟器件：通过离子注入形成亚表面沟道，载流子远离界面</li>
<li>噪声降低：1/f噪声降低5-10倍</li>
<li>代价：阈值电压控制复杂，需要额外工艺步骤</li>
</ul>
<ol start="4">
<li><strong>源极退化技术</strong></li>
</ol>
<p>在源极串联小电阻提供局部负反馈：</p>
<ul>
<li>改善线性度</li>
<li>降低g_m变化</li>
<li>轻微增加噪声（可接受的代价）</li>
</ul>
<p><strong>列级优化技术</strong></p>
<p>列放大器和CDS电路的噪声优化关注低频噪声消除和带宽噪声抑制：</p>
<ol>
<li><strong>斩波稳定（Chopper Stabilization）技术</strong></li>
</ol>
<p>斩波技术通过调制解调过程将1/f噪声移到高频：</p>
<div class="codehilite"><pre><span></span><code>工作原理：
输入 → 调制(f_chop) → 放大器 → 解调(f_chop) → 低通滤波 → 输出
        ↑                                ↑
        └────────── f_chop时钟 ──────────┘
</code></pre></div>

<p>关键参数设计：</p>
<ul>
<li>斩波频率：f_chop &gt; 10×信号带宽（避免混叠）</li>
<li>典型值：100kHz-1MHz</li>
<li>残余噪声：斩波尖峰需要额外滤波</li>
<li>实现复杂度：需要精确的时钟相位</li>
</ul>
<p>效果：1/f噪声降低20-40dB，但增加高频噪声底。</p>
<ol start="2">
<li><strong>相关多采样（CMS）技术</strong></li>
</ol>
<p>CMS通过多次采样平均降低随机噪声：</p>
<div class="codehilite"><pre><span></span><code>噪声降低因子：√N（N为采样次数）
时间代价：N倍采样时间
</code></pre></div>

<p>实现方式：</p>
<ul>
<li>模拟域平均：多个采样电容并联</li>
<li>数字域平均：ADC后数字累加</li>
<li>优化采样：非均匀时间间隔，优化噪声传递函数</li>
</ul>
<p>实际限制：</p>
<ul>
<li>N=4-16比较实用</li>
<li>再增加N，收益递减</li>
<li>需要权衡帧率</li>
</ul>
<ol start="3">
<li><strong>自动归零（Auto-Zero）技术</strong></li>
</ol>
<p>消除放大器失调和低频噪声：</p>
<div class="codehilite"><pre><span></span><code>两相工作：
φ1（自动归零相）：

- 输入短路
- 存储失调电压到电容
φ2（放大相）：

- 正常放大
- 失调电压被减去
</code></pre></div>

<p>优势：</p>
<ul>
<li>完全消除DC失调</li>
<li>大幅降低1/f噪声</li>
<li>不需要匹配</li>
</ul>
<p>缺点：</p>
<ul>
<li>增加宽带噪声（噪声折叠）</li>
<li>需要两倍时间</li>
<li>开关噪声注入</li>
</ul>
<ol start="4">
<li><strong>相关电平偏移（CLS）技术</strong></li>
</ol>
<p>结合CDS和可调偏移，优化暗电流补偿：</p>
<ul>
<li>在复位电平加入可编程偏移</li>
<li>补偿暗电流积累</li>
<li>扩展动态范围下限</li>
</ul>
<p><strong>系统级噪声管理</strong></p>
<ol>
<li><strong>噪声预算分配</strong>：</li>
</ol>
<div class="codehilite"><pre><span></span><code>总噪声目标：1e⁻（一个电子）
分配示例：

- 光子散粒噪声：0.7e⁻（不可避免）
- SF噪声：0.5e⁻
- CDS/放大器：0.4e⁻  
- ADC量化：0.3e⁻
</code></pre></div>

<ol start="2">
<li><strong>多增益读出（MGR）</strong>：
同时读出高低增益通道，后期合成HDR图像：</li>
</ol>
<ul>
<li>低增益通道：捕获高光细节</li>
<li>高增益通道：保留暗部信息</li>
<li>数字域融合：无缝过渡</li>
</ul>
<ol start="3">
<li><strong>噪声整形技术</strong>：
将噪声能量移到不敏感频段：</li>
</ol>
<ul>
<li>过采样+数字滤波</li>
<li>Σ-Δ调制思想应用</li>
<li>带外噪声不影响图像质量</li>
</ul>
<h2 id="52-cds">5.2 相关双采样（CDS）电路</h2>
<p>相关双采样是CMOS图像传感器中消除固定模式噪声（FPN）的核心技术，通过对复位电平和信号电平的差分处理，有效消除像素间的阈值电压差异和kTC噪声。</p>
<h3 id="521-cds">5.2.1 CDS原理与时序</h3>
<p><strong>基本工作流程</strong></p>
<div class="codehilite"><pre><span></span><code>时序图：
RST  ──┐    ┌──
       └────┘
TX   ────┐  ┌──
         └──┘
SHR  ──┐  ┌────
       └──┘
SHS  ──────┐  ┌
           └──┘

信号：
V_FD  V_rst─────┐
              └─V_sig

CDS = V_sig - V_rst
</code></pre></div>

<ol>
<li><strong>复位采样</strong>（SHR）：采样复位后的FD电压V_rst</li>
<li><strong>电荷转移</strong>：TX脉冲将光生电荷转移到FD</li>
<li><strong>信号采样</strong>（SHS）：采样包含信号的FD电压V_sig</li>
<li><strong>差分输出</strong>：CDS_out = V_sig - V_rst</li>
</ol>
<h3 id="522-cds">5.2.2 模拟CDS实现</h3>
<p><strong>开关电容实现</strong></p>
<div class="codehilite"><pre><span></span><code>         C_1
    ┌────┤├────┐
    |          |
V_pix──S1──┬──S3──┤-\
           |      |  &gt;──── V_out
          C_2     ┤+/
           |      |
         ──S2──┬──S4
               |
             V_ref
</code></pre></div>

<p>工作阶段：</p>
<ul>
<li>φ1：S1、S2闭合，采样V_rst到C_1、C_2</li>
<li>φ2：S3、S4闭合，采样V_sig并输出差值</li>
</ul>
<p><strong>连续时间CDS</strong></p>
<p>采用差分放大器直接实现：</p>
<div class="codehilite"><pre><span></span><code>V_rst ──┤&gt;──┐
            ├─── V_out = G × (V_sig - V_rst)
V_sig ──┤&gt;──┘
</code></pre></div>

<p>优点：结构简单，功耗低
缺点：需要精确匹配，易受失调影响</p>
<h3 id="523-cds">5.2.3 数字CDS实现</h3>
<p>在列ADC后进行数字域CDS：</p>
<div class="codehilite"><pre><span></span><code>优势：

<span class="k">-</span> 不受模拟失配影响
<span class="k">-</span> 可实现复杂算法
<span class="k">-</span> 易于集成多种降噪技术

实现方式：
D_out = ADC(V_sig) - ADC(V_rst)
</code></pre></div>

<p><strong>双斜率积分ADC中的CDS</strong></p>
<div class="codehilite"><pre><span></span><code>积分器输出：
      /│    │\
     / │    │ \
    /  │    │  \
   /   │    │   \
  /    │    │    \
 /     │    │     \
└──────┴────┴──────
 T_rst T_sig T_ref

计数值：N_CDS = N_sig - N_rst
</code></pre></div>

<h3 id="524-cds">5.2.4 CDS性能分析</h3>
<p><strong>噪声抑制能力</strong></p>
<p>CDS对不同噪声源的抑制效果：</p>
<ol>
<li><strong>完全抑制</strong>：固定模式噪声（FPN）、失调电压</li>
<li><strong>部分抑制</strong>：kTC噪声（相关部分）</li>
<li><strong>无法抑制</strong>：光子散粒噪声、读出噪声</li>
</ol>
<p>噪声传递函数：</p>
<div class="codehilite"><pre><span></span><code>NTF(f) = 2 × |sin(πfT_CDS)|
</code></pre></div>

<p>其中T_CDS是两次采样的时间间隔。</p>
<p><strong>带宽考虑</strong></p>
<p>CDS引入的带宽限制：</p>
<ul>
<li>有效带宽：BW_eff ≈ 1/(2πT_CDS)</li>
<li>建立时间要求：t_settle &gt; 5τ（τ为RC时间常数）</li>
</ul>
<h2 id="53-adc">5.3 列并行ADC架构</h2>
<p>列并行ADC是现代CMOS图像传感器的主流架构，每列配置独立ADC，实现高速并行转换。</p>
<h3 id="531">5.3.1 架构比较</h3>
<p><strong>串行ADC架构</strong></p>
<div class="codehilite"><pre><span></span><code>像素阵列
    ↓
  MUX
    ↓
单个高速ADC
    ↓
数字输出
</code></pre></div>

<ul>
<li>优点：面积小，匹配好</li>
<li>缺点：速度受限，功耗高</li>
</ul>
<p><strong>列并行架构</strong></p>
<div class="codehilite"><pre><span></span><code>像素阵列
↓ ↓ ↓ ↓
ADC ADC ADC ADC
↓ ↓ ↓ ↓
数字处理
</code></pre></div>

<ul>
<li>优点：高帧率，低功耗</li>
<li>缺点：面积大，列间匹配挑战</li>
</ul>
<h3 id="532-adc">5.3.2 列ADC类型选择</h3>
<p>不同ADC类型在CMOS传感器中的适用性：</p>
<p>| ADC类型 | 分辨率 | 速度 | 功耗 | 面积 | 应用场景 |</p>
<table>
<thead>
<tr>
<th>ADC类型</th>
<th>分辨率</th>
<th>速度</th>
<th>功耗</th>
<th>面积</th>
<th>应用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>斜坡ADC</td>
<td>10-14位</td>
<td>中等</td>
<td>低</td>
<td>小</td>
<td>主流选择</td>
</tr>
<tr>
<td>SAR ADC</td>
<td>8-12位</td>
<td>快</td>
<td>中等</td>
<td>中等</td>
<td>高帧率</td>
</tr>
<tr>
<td>Σ-Δ ADC</td>
<td>12-16位</td>
<td>慢</td>
<td>高</td>
<td>大</td>
<td>高精度</td>
</tr>
<tr>
<td>循环ADC</td>
<td>10-12位</td>
<td>中等</td>
<td>中等</td>
<td>小</td>
<td>紧凑设计</td>
</tr>
</tbody>
</table>
<h3 id="533">5.3.3 列固定模式噪声校正</h3>
<p><strong>数字校正技术</strong></p>
<ol>
<li><strong>增益校正</strong>：</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">G_cal</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mean</span><span class="p">(</span><span class="n">all_columns</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Mean</span><span class="p">(</span><span class="n">column_i</span><span class="p">)</span>
<span class="k">Output</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Input</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="n">G_cal</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</code></pre></div>

<ol start="2">
<li><strong>失调校正</strong>：</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">Offset</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dark_level</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Target_black</span>
<span class="k">Output</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Input</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Offset</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</code></pre></div>

<p><strong>片上校准电路</strong></p>
<div class="codehilite"><pre><span></span><code>校准流程：

1. 暗场采集 → 失调校准系数
2. 均匀光照 → 增益校准系数
3. 存储系数到片上存储器
4. 实时应用校正
</code></pre></div>

<h2 id="54-adc">5.4 斜坡ADC设计</h2>
<p>斜坡ADC（Ramp ADC）因其结构简单、功耗低、易于实现高分辨率而成为CMOS图像传感器的主流选择。</p>
<h3 id="541-adc">5.4.1 单斜率ADC原理</h3>
<p><strong>基本结构</strong></p>
<div class="codehilite"><pre><span></span><code>        比较器
V_pixel ──┤-\
          |  &gt;─── D_out
V_ramp ───┤+/     ↓
          ↑    计数器
      斜坡发生器   ↑
                 CLK
</code></pre></div>

<p>工作过程：</p>
<ol>
<li>斜坡电压从V_min线性增加到V_max</li>
<li>当V_ramp &gt; V_pixel时，比较器翻转</li>
<li>记录此时的计数值作为数字输出</li>
</ol>
<p>转换时间：T_conv = 2^N × T_clk（N位分辨率）</p>
<h3 id="542-adc">5.4.2 双斜率ADC优化</h3>
<p><strong>双斜率转换提高速度</strong></p>
<div class="codehilite"><pre><span></span><code>粗转换阶段（MSB）：
大步进斜坡，快速逼近
↓
细转换阶段（LSB）：
小步进斜坡，精确量化

总转换时间：T_total = 2^(N/2) × T_clk × 2
</code></pre></div>

<p>相比单斜率，速度提升√(2^N)倍。</p>
<h3 id="543">5.4.3 斜坡发生器设计</h3>
<p><strong>电流舵DAC实现</strong></p>
<div class="codehilite"><pre><span></span><code><span class="w">     </span><span class="n">I_ref</span>
<span class="w">       </span><span class="err">↓</span>
<span class="w">   </span><span class="err">┌───┼───┬───┬───┐</span>
<span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="w">  </span><span class="mi">2</span><span class="o">^</span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="o">^</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="o">^</span><span class="mi">3</span><span class="w"> </span><span class="mi">2</span><span class="o">^</span><span class="n">N</span>
<span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span>
<span class="w">   </span><span class="n">SW</span><span class="w">  </span><span class="n">SW</span><span class="w">  </span><span class="n">SW</span><span class="w">  </span><span class="n">SW</span><span class="w">  </span><span class="n">SW</span>
<span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span><span class="w">   </span><span class="err">↓</span>
<span class="w">   </span><span class="err">└───┴───┴───┴───┘</span>
<span class="w">           </span><span class="err">↓</span>
<span class="w">         </span><span class="n">R_load</span>
<span class="w">           </span><span class="err">↓</span>
<span class="w">         </span><span class="n">V_ramp</span>
</code></pre></div>

<p>线性度要求：</p>
<ul>
<li>DNL &lt; 0.5 LSB</li>
<li>INL &lt; 1 LSB</li>
<li>单调性保证</li>
</ul>
<p><strong>积分器型斜坡发生器</strong></p>
<div class="codehilite"><pre><span></span><code>       I_ref
         ↓
     ┌───┤
     │   │
     │  ═╪═ C_int
     │   │
     └───┤-\
         |  &gt;─── V_ramp
     ┌───┤+/
     │
   V_ref
</code></pre></div>

<p>斜率：dV/dt = I_ref / C_int</p>
<p>优点：</p>
<ul>
<li>本质单调</li>
<li>线性度好</li>
<li>噪声低</li>
</ul>
<h3 id="544">5.4.4 比较器设计考虑</h3>
<p><strong>动态比较器</strong></p>
<div class="codehilite"><pre><span></span><code>      CLK
       ↓
    ┌──┴──┐
    │     │
V_in─┤  D  ├─D_out
    │     │
V_ref┤     │
    └─────┘
</code></pre></div>

<p>关键参数：</p>
<ul>
<li>失调电压：&lt; 1 LSB</li>
<li>比较速度：&lt; T_clk/4</li>
<li>功耗：动态功耗为主</li>
<li>噪声：输入参考噪声 &lt; 0.5 LSB_rms</li>
</ul>
<p><strong>失调校准技术</strong></p>
<ol>
<li>
<p><strong>前台校准</strong>：
   - 输入短接测量失调
   - 存储校准值
   - 运行时补偿</p>
</li>
<li>
<p><strong>后台校准</strong>：
   - 利用冗余比较器
   - 实时跟踪失调变化
   - 自适应补偿</p>
</li>
</ol>
<h2 id="55-adc">5.5 逐次逼近ADC</h2>
<p>SAR ADC在CMOS图像传感器中提供了速度和功耗的良好平衡，特别适合高帧率应用。</p>
<h3 id="551-sar-adc">5.5.1 SAR ADC基本原理</h3>
<p><strong>二进制搜索算法</strong></p>
<div class="codehilite"><pre><span></span><code>初始：设置MSB=1
循环N次：
  if (V_in &gt; V_DAC)
    保持当前位=1
  else
    清除当前位=0
  移至下一位
</code></pre></div>

<p><strong>架构框图</strong></p>
<div class="codehilite"><pre><span></span><code>        ┌─────────┐
V_in ───┤S/H      │
        └────┬────┘
             │
        ┌────↓────┐
        │比较器   │
        └────┬────┘
             │
        ┌────↓────┐
        │SAR逻辑 │
        └────┬────┘
             │
        ┌────↓────┐
        │  DAC    │
        └─────────┘
</code></pre></div>

<h3 id="552-dac">5.5.2 电容阵列DAC</h3>
<p><strong>二进制权重电容阵列</strong></p>
<div class="codehilite"><pre><span></span><code>V_in ──S1──┬──┬──┬──┬──┬── V_x
           │  │  │  │  │
          8C 4C 2C  C  C
           │  │  │  │  │
          S2 S3 S4 S5 S6
         ↙ ↘
      V_ref GND
</code></pre></div>

<p>转换步骤：</p>
<ol>
<li>采样：所有电容接V_in</li>
<li>保持：底板切换到V_ref或GND</li>
<li>电荷重分配产生比较电压</li>
</ol>
<p><strong>分段电容阵列</strong></p>
<p>减少电容总量和面积：</p>
<div class="codehilite"><pre><span></span><code>MSB段          LSB段
├──4C──2C──C──┼──C/16──┼──4C──2C──C──┤
              │        │
           C_bridge  C_atten
</code></pre></div>

<p>总电容减少：从2^N×C降至2×2^(N/2)×C</p>
<h3 id="553-sar-adccmos">5.5.3 SAR ADC在CMOS传感器中的优化</h3>
<p><strong>异步SAR时序</strong></p>
<p>消除外部高频时钟需求：</p>
<div class="codehilite"><pre><span></span><code>比较器就绪信号触发下一位转换
├─比较─┼─DAC建立─┼─比较─┼─DAC建立─┼...
自适应时序，提高平均转换速度
</code></pre></div>

<p><strong>噪声整形SAR</strong></p>
<p>结合Σ-Δ调制器思想：</p>
<div class="codehilite"><pre><span></span><code>       ┌─────────┐
V_in──→│ SAR核心 ├──→D_out
       └────┬────┘
            │
       ┌────↓────┐
       │噪声整形 │
       │  滤波器 │
       └─────────┘
</code></pre></div>

<p>有效位数提升1-2位，代价是转换时间增加。</p>
<p><strong>列间失配校准</strong></p>
<ol>
<li>
<p><strong>前台校准模式</strong>：
   - 所有列输入相同参考电压
   - 测量各列输出差异
   - 计算校准系数</p>
</li>
<li>
<p><strong>伪随机抖动技术</strong>：
   - 在LSB级别加入抖动
   - 多帧平均消除量化误差
   - 改善列间一致性</p>
</li>
</ol>
<h2 id="56-adccmos">5.6 Σ-Δ ADC在CMOS传感器中的应用</h2>
<p>Σ-Δ ADC通过过采样和噪声整形实现高分辨率，适合低速高精度应用。</p>
<h3 id="561-">5.6.1 Σ-Δ调制器原理</h3>
<p><strong>一阶Σ-Δ调制器</strong></p>
<div class="codehilite"><pre><span></span><code>        ┌───┐     ┌───┐
X(z)──→⊕──→│∫  ├──→│Q  ├──→Y(z)
      ↑    └───┘    └───┘
      │                │
      └────────────────┘
           -1
</code></pre></div>

<p>信号传递函数：STF(z) = 1
噪声传递函数：NTF(z) = 1 - z^(-1)</p>
<p>量化噪声被推到高频，通过数字滤波器抑制。</p>
<p><strong>二阶调制器改进</strong></p>
<div class="codehilite"><pre><span></span><code>NTF(z) = (1 - z^(-1))^2
</code></pre></div>

<p>40dB/dec的噪声整形斜率，显著提高信噪比。</p>
<h3 id="562-adc">5.6.2 增量型Σ-Δ ADC</h3>
<p>专为图像传感器优化的Σ-Δ架构：</p>
<p><strong>工作原理</strong></p>
<ol>
<li>每个像素转换前复位调制器</li>
<li>固定采样周期内计数</li>
<li>无需复杂抽取滤波器</li>
</ol>
<div class="codehilite"><pre><span></span><code>转换周期：
├─复位─┼─────积分/计数─────┼─输出─┤
       └──────OSR周期──────┘
</code></pre></div>

<p><strong>优势</strong>：</p>
<ul>
<li>结构简单</li>
<li>无需连续工作</li>
<li>适合列并行实现</li>
</ul>
<h3 id="563">5.6.3 实现考虑</h3>
<p><strong>运算放大器要求</strong></p>
<p>增益带宽积：GBW &gt; OSR × f_s × 5
其中OSR是过采样率，f_s是采样频率。</p>
<div class="codehilite"><pre><span></span><code>功耗优化策略：

- 动态偏置
- 类AB输出级
- 开关运放技术
</code></pre></div>

<p><strong>数字滤波器设计</strong></p>
<p>简单计数器实现sinc滤波器：</p>
<div class="codehilite"><pre><span></span><code>H(z) = [1 - z^(-OSR)] / [OSR × (1 - z^(-1))]
</code></pre></div>

<p>级联实现高阶滤波：</p>
<div class="codehilite"><pre><span></span><code>sinc^2: 两级计数器级联
sinc^3: 三级计数器级联
</code></pre></div>

<p><strong>过采样率选择</strong></p>
<p>权衡因素：
| OSR | 分辨率提升 | 转换时间 | 功耗 |</p>
<table>
<thead>
<tr>
<th>OSR</th>
<th>分辨率提升</th>
<th>转换时间</th>
<th>功耗</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>2 bits</td>
<td>16×</td>
<td>低</td>
</tr>
<tr>
<td>64</td>
<td>3 bits</td>
<td>64×</td>
<td>中</td>
</tr>
<tr>
<td>256</td>
<td>4 bits</td>
<td>256×</td>
<td>高</td>
</tr>
</tbody>
</table>
<h3 id="564-adc">5.6.4 混合架构ADC</h3>
<p><strong>SAR-Σ-Δ混合</strong></p>
<p>结合两者优势：</p>
<div class="codehilite"><pre><span></span><code>第一级：8位SAR粗量化
    ↓
残差放大
    ↓
第二级：4位Σ-Δ细量化
    ↓
数字组合：12-14位输出
</code></pre></div>

<p>优点：</p>
<ul>
<li>速度比纯Σ-Δ快</li>
<li>精度比纯SAR高</li>
<li>功耗适中</li>
</ul>
<h2 id="_2">本章小结</h2>
<p>本章系统介绍了CMOS图像传感器读出电路的设计要点：</p>
<h3 id="_3">核心概念回顾</h3>
<ol>
<li>
<p><strong>源跟随器与列放大器</strong>
   - SF增益：A_SF ≈ 1 - 1/(g_m × R_load)
   - 噪声贡献：热噪声和1/f噪声
   - PGA提供可编程增益适应动态范围</p>
</li>
<li>
<p><strong>相关双采样（CDS）</strong>
   - 消除原理：V_out = V_sig - V_rst
   - 完全抑制FPN和失调
   - 部分抑制kTC噪声</p>
</li>
<li>
<p><strong>列并行ADC架构</strong>
   - 并行度提升帧率
   - 列间匹配是关键挑战
   - 数字校正补偿失配</p>
</li>
<li>
<p><strong>斜坡ADC</strong>
   - 转换时间：T = 2^N × T_clk
   - 双斜率优化速度
   - 线性度依赖于斜坡发生器</p>
</li>
<li>
<p><strong>SAR ADC</strong>
   - N位需要N个时钟周期
   - 电容阵列实现DAC
   - 异步时序提高效率</p>
</li>
<li>
<p><strong>Σ-Δ ADC</strong>
   - 过采样率OSR决定精度提升
   - 噪声整形：NTF(z) = (1-z^(-1))^L
   - 增量型适合图像传感器</p>
</li>
</ol>
<h3 id="_4">关键设计公式</h3>
<p><strong>噪声计算</strong>：</p>
<ul>
<li>总读出噪声：σ_read = √(σ_SF^2 + σ_CDS^2 + σ_ADC^2)</li>
<li>CDS噪声增益：√2（对不相关噪声）</li>
<li>ADC量化噪声：σ_q = LSB/√12</li>
</ul>
<p><strong>速度-功耗权衡</strong>：</p>
<ul>
<li>斜坡ADC：P ∝ 2^N × f_frame</li>
<li>SAR ADC：P ∝ N × C × V^2 × f_frame</li>
<li>Σ-Δ ADC：P ∝ OSR × f_pixel</li>
</ul>
<p><strong>动态范围</strong>：</p>
<ul>
<li>DR = 20log10(V_full_scale / V_noise)</li>
<li>CDS后DR提升：~6dB（消除FPN）</li>
</ul>
<h2 id="_5">练习题</h2>
<h3 id="_6">基础题</h3>
<p><strong>习题5.1</strong> 源跟随器设计
一个像素源跟随器，晶体管W/L=10μm/1μm，μ_n×C_ox=100μA/V^2，偏置电流I_bias=10μA。计算：
a) 跨导g_m
b) 如果列线电容C_col=5pF，估算建立时间
c) 输入参考热噪声（T=300K）</p>
<details>
<summary>答案</summary>
<p>a) g_m = √(2×μ_n×C_ox×(W/L)×I_bias) = √(2×100×10×10) = 44.7μS</p>
<p>b) t_settle ≈ 3×C_col/g_m = 3×5pF/44.7μS = 335ns</p>
<p>c) v_n = √(4kT×(2/3)/g_m) = √(4×1.38×10^(-23)×300×0.67/44.7×10^(-6)) = 313μV_rms</p>
</details>
<p><strong>习题5.2</strong> CDS时序分析
4T像素的CDS操作，复位采样到信号采样间隔T_CDS=10μs。如果像素输出带宽需要大于100kHz，判断CDS是否会限制带宽？如何优化？</p>
<details>
<summary>答案</summary>
<p>CDS有效带宽：BW_eff = 1/(2π×T_CDS) = 1/(2π×10μs) = 15.9kHz</p>
<p>这远小于100kHz要求，CDS会严重限制带宽。</p>
<p>优化方案：</p>
<ol>
<li>减小T_CDS到1μs以下</li>
<li>采用管线化读出，交错多行CDS操作</li>
<li>使用列并行CDS，每列独立时序</li>
</ol>
</details>
<p><strong>习题5.3</strong> 斜坡ADC转换时间
设计12位斜坡ADC，时钟频率f_clk=100MHz，计算：
a) 单斜率转换时间
b) 双斜率（6+6位）转换时间
c) 要达到30fps全画幅（1920×1080）读出，需要多少列并行ADC？</p>
<details>
<summary>答案</summary>
<p>a) T_single = 2^12 × (1/100MHz) = 4096 × 10ns = 40.96μs</p>
<p>b) T_double = 2×2^6 × 10ns = 128 × 10ns = 1.28μs</p>
<p>c) 总像素：1920×1080 = 2,073,600
   每帧时间：1/30 = 33.33ms
   每像素时间：33.33ms/2,073,600 = 16.08ns</p>
<p>使用双斜率，需要列数：1.28μs/16.08ns = 79.6 ≈ 80列
   实际采用1920列并行更合理</p>
</details>
<h3 id="_7">挑战题</h3>
<p><strong>习题5.4</strong> SAR ADC电容阵列设计
设计10位SAR ADC的分段电容DAC，单位电容C_u=10fF，要求：
a) 计算传统二进制阵列的总电容
b) 设计5+5分段结构，计算衰减电容值
c) 分析kT/C噪声对SNR的影响</p>
<details>
<summary>答案</summary>
<p>a) 传统阵列：C_total = 2^10 × C_u = 1024 × 10fF = 10.24pF</p>
<p>b) 5+5分段：
   MSB段：(1+2+4+8+16)×C_u = 31C_u
   LSB段：(1+2+4+8+16)×C_u = 31C_u
   衰减电容：C_atten = C_u（实现32:1衰减）
   总电容：~64C_u = 640fF（16倍减少）</p>
<p>c) kT/C噪声：
   v_n = √(kT/C_total) = √(4.1×10^(-21)/640fF) = 80μV_rms
   10位满幅1V，LSB = 976μV
   SNR_thermal = 20log10(976μV/80μV) = 21.7dB
   需要增大电容或降低满幅范围改善SNR</p>
</details>
<p><strong>习题5.5</strong> Σ-Δ ADC过采样设计
设计增量型Σ-Δ ADC用于低噪声成像，目标14位ENOB，使用二阶调制器。计算所需OSR，并分析功耗影响。</p>
<details>
<summary>答案</summary>
<p>二阶Σ-Δ的SQNR改善：
ΔSQNR = 10log10(OSR^5) = 50log10(OSR) dB</p>
<p>14位ENOB需要SNR = 6.02×14 + 1.76 = 86dB</p>
<p>基础量化器按1位计算，需要额外SNR提升：
86 - 7.78 = 78.22dB</p>
<p>所需OSR：50log10(OSR) = 78.22
OSR = 10^(78.22/50) = 37</p>
<p>实际选择OSR = 64（2的幂次方便实现）</p>
<p>功耗影响：</p>
<ul>
<li>运放需要GBW &gt; 64×f_s×5 = 320×f_s</li>
<li>功耗正比于GBW，比Nyquist采样高320倍</li>
<li>可通过动态偏置和时钟门控优化</li>
</ul>
</details>
<p><strong>习题5.6</strong> 列FPN校正算法
1000列传感器，测得列增益标准差σ_g=2%，列失调标准差σ_o=5mV（12位ADC，满幅1V）。设计数字校正算法，分析校正精度要求。</p>
<details>
<summary>答案</summary>
<p>增益校正精度分析：</p>
<ul>
<li>2%增益误差 = 20mV误差（1V信号时）</li>
<li>12位LSB = 244μV</li>
<li>需要校正到&lt; 0.5 LSB，精度要求0.01%</li>
</ul>
<p>失调校正精度分析：</p>
<ul>
<li>5mV失调 = 20.5 LSB</li>
<li>必须精确校正</li>
<li>至少需要14位精度存储校正值</li>
</ul>
<p>校正算法：</p>
<ol>
<li>暗场采集1000帧平均→失调校准值O[i]</li>
<li>均匀光50%满幅采集→增益校准值G[i]</li>
<li>实时校正：Out[i] = (In[i] - O[i]) × G_avg/G[i]</li>
</ol>
<p>存储需求：1000列×(14+14)位 = 28kbits片上存储</p>
</details>
<p><strong>习题5.7</strong> 混合ADC架构优化
设计SAR-斜坡混合ADC，目标12位、1MS/s。SAR完成8位MSB，斜坡完成4位LSB。优化时序分配和功耗。</p>
<details>
<summary>答案</summary>
<p>时序分配（总时间1μs）：</p>
<ul>
<li>SAR 8位：8×50ns = 400ns（留余量给DAC建立）</li>
<li>采样保持：100ns</li>
<li>斜坡4位：16×30ns = 480ns</li>
<li>数字处理：20ns
总计：1000ns = 1μs</li>
</ul>
<p>功耗优化：</p>
<ol>
<li>
<p>SAR部分：
   - 使用异步逻辑，平均只需6个比较
   - 电容阵列：256C_u（vs 4096C_u全SAR）
   - 动态功耗：P_SAR = f×C×V^2 = 1MHz×256×10fF×1V^2 = 2.56μW</p>
</li>
<li>
<p>斜坡部分：
   - 只需4位精度斜坡发生器
   - 比较器可以放宽要求
   - P_ramp ≈ 1μW</p>
</li>
<li>
<p>总功耗：~4μW（比12位纯SAR降低60%）</p>
</li>
</ol>
<p>误差分配：</p>
<ul>
<li>SAR DNL &lt; 0.5 LSB_8bit = 2 LSB_12bit</li>
<li>斜坡线性度 &lt; 0.5 LSB_12bit</li>
<li>接口误差通过冗余位解决</li>
</ul>
</details>
<p><strong>习题5.8</strong> 读出链路噪声预算
完整读出链路：像素SF → CDS → PGA(增益4) → 12位ADC。
给定：SF噪声100μV_rms，CDS后噪声150μV_rms，ADC噪声0.5LSB_rms。计算输入参考总噪声，并提出优化方案。</p>
<details>
<summary>答案</summary>
<p>噪声分析（输入参考）：</p>
<ol>
<li>SF噪声：100μV_rms</li>
<li>
<p>CDS增益：√2（对随机噪声）
   CDS后：100×√2 = 141μV_rms（与测量150μV接近）</p>
</li>
<li>
<p>PGA噪声（假设10μV_rms输入参考）</p>
</li>
<li>ADC噪声：0.5×(1V/4096)/4 = 30.5μV_rms（折合到输入）</li>
</ol>
<p>总噪声：σ_total = √(150^2 + 10^2 + 30.5^2) = 153μV_rms</p>
<p>优化方案：</p>
<ol>
<li>
<p>降低SF噪声：
   - 增大SF晶体管面积（W×L×4→噪声/2）
   - 提高偏置电流（I×4→噪声/2）</p>
</li>
<li>
<p>改进CDS：
   - 采用相关多采样（4次平均→噪声/2）
   - 优化采样电容减少kT/C</p>
</li>
<li>
<p>ADC优化：
   - 使用14位ADC（噪声降至1/4）
   - 或在PGA前端增加预放大</p>
</li>
</ol>
<p>目标：降至&lt; 50μV_rms需要综合优化</p>
</details>
<h2 id="_8">常见陷阱与错误</h2>
<h3 id="1">1. 源跟随器设计陷阱</h3>
<p><strong>错误</strong>：忽略体效应导致增益下降</p>
<ul>
<li>SF晶体管的阈值电压随源极电压变化</li>
<li>实际增益低于理想值</li>
<li><strong>解决</strong>：采用深N阱隔离或考虑体效应补偿</li>
</ul>
<p><strong>错误</strong>：偏置电流源进入线性区</p>
<ul>
<li>列电压摆幅受限</li>
<li>非线性失真增加</li>
<li><strong>解决</strong>：确保V_DS,bias &gt; V_GS - V_th，采用级联电流源</li>
</ul>
<h3 id="2-cds">2. CDS实施错误</h3>
<p><strong>错误</strong>：采样时序不当引入额外噪声</p>
<ul>
<li>复位噪声未完全相关</li>
<li>引入额外的采样噪声</li>
<li><strong>解决</strong>：确保复位完全建立后采样，优化采样间隔</li>
</ul>
<p><strong>错误</strong>：忽略有限带宽影响</p>
<ul>
<li>CDS限制了信号带宽</li>
<li>快速信号被衰减</li>
<li><strong>解决</strong>：根据应用需求设计CDS带宽，考虑管线化结构</li>
</ul>
<h3 id="3-adc">3. ADC设计常见问题</h3>
<p><strong>错误</strong>：斜坡ADC线性度问题</p>
<ul>
<li>斜坡非线性导致DNL/INL恶化</li>
<li>图像出现条纹</li>
<li><strong>解决</strong>：采用积分器型斜坡，加强电流源匹配</li>
</ul>
<p><strong>错误</strong>：SAR ADC电容失配</p>
<ul>
<li>DAC非单调</li>
<li>丢码现象</li>
<li><strong>解决</strong>：增加冗余位，采用校准技术</li>
</ul>
<p><strong>错误</strong>：Σ-Δ ADC稳定性问题</p>
<ul>
<li>高阶调制器不稳定</li>
<li>输出饱和</li>
<li><strong>解决</strong>：限制输入范围，采用稳定的NTF设计</li>
</ul>
<h3 id="4">4. 系统级错误</h3>
<p><strong>错误</strong>：忽略串扰影响</p>
<ul>
<li>相邻列信号耦合</li>
<li>出现鬼影</li>
<li><strong>解决</strong>：增加屏蔽，优化布局布线</li>
</ul>
<p><strong>错误</strong>：时钟抖动影响</p>
<ul>
<li>ADC精度下降</li>
<li>增加噪声</li>
<li><strong>解决</strong>：使用低抖动时钟源，优化时钟分配网络</li>
</ul>
<p><strong>错误</strong>：电源噪声耦合</p>
<ul>
<li>PSRR不足</li>
<li>横条纹噪声</li>
<li><strong>解决</strong>：独立电源域，增加去耦电容，差分结构</li>
</ul>
<h3 id="5_1">5. 调试技巧</h3>
<p><strong>列FPN诊断</strong></p>
<div class="codehilite"><pre><span></span><code>症状：垂直条纹
检查：

1. 测量暗场图像，分析列均值分布
2. 检查列放大器失调
3. 验证ADC参考电压一致性
</code></pre></div>

<p><strong>随机噪声过大</strong></p>
<div class="codehilite"><pre><span></span><code>症状：图像颗粒感强
检查：

1. 测量各级噪声贡献
2. 检查CDS时序
3. 验证偏置电流稳定性
</code></pre></div>

<p><strong>非线性失真</strong></p>
<div class="codehilite"><pre><span></span><code>症状：灰度不连续
检查：

1. 测试ADC的DNL/INL
2. 检查SF工作点
3. 验证斜坡线性度
</code></pre></div>

<h2 id="_9">最佳实践检查清单</h2>
<h3 id="_10">设计阶段</h3>
<h4 id="_11">源跟随器与放大器</h4>
<ul>
<li>[ ] SF晶体管尺寸优化（噪声vs速度）</li>
<li>[ ] 偏置电流选择（功耗vs性能）</li>
<li>[ ] 体效应补偿考虑</li>
<li>[ ] 列放大器增益可编程性</li>
<li>[ ] 差分架构提高PSRR</li>
<li>[ ] 失调校准机制</li>
</ul>
<h4 id="cds">CDS电路</h4>
<ul>
<li>[ ] 采样时序优化</li>
<li>[ ] kTC噪声最小化</li>
<li>[ ] 带宽与建立时间平衡</li>
<li>[ ] 数字CDS vs 模拟CDS选择</li>
<li>[ ] 相关多采样选项</li>
</ul>
<h4 id="adc">ADC选择与设计</h4>
<ul>
<li>[ ] ADC类型匹配应用需求</li>
<li>[ ] 分辨率与速度权衡</li>
<li>[ ] 功耗预算分配</li>
<li>[ ] 列间匹配规格</li>
<li>[ ] 校准策略制定</li>
</ul>
<h3 id="_12">版图设计</h3>
<h4 id="_13">匹配与屏蔽</h4>
<ul>
<li>[ ] 关键器件匹配版图</li>
<li>[ ] 敏感信号屏蔽</li>
<li>[ ] 电源/地线规划</li>
<li>[ ] 去耦电容布置</li>
<li>[ ] 热梯度考虑</li>
</ul>
<h4 id="_14">信号完整性</h4>
<ul>
<li>[ ] 最小化寄生电容</li>
<li>[ ] 减少串扰路径</li>
<li>[ ] 时钟树平衡</li>
<li>[ ] 参考电压分配网络</li>
<li>[ ] ESD保护设计</li>
</ul>
<h3 id="_15">验证测试</h3>
<h4 id="_16">功能验证</h4>
<ul>
<li>[ ] 全信号范围测试</li>
<li>[ ] 各增益档位验证</li>
<li>[ ] CDS功能确认</li>
<li>[ ] ADC单调性测试</li>
<li>[ ] 时序裕量验证</li>
</ul>
<h4 id="_17">性能表征</h4>
<ul>
<li>[ ] 噪声水平测量</li>
<li>[ ] 线性度（DNL/INL）测试</li>
<li>[ ] 动态范围验证</li>
<li>[ ] 功耗测量</li>
<li>[ ] 温度特性测试</li>
</ul>
<h4 id="_18">系统集成</h4>
<ul>
<li>[ ] 与ISP接口验证</li>
<li>[ ] 时钟域交叉检查</li>
<li>[ ] 电源序列验证</li>
<li>[ ] EMI/EMC测试</li>
<li>[ ] 可靠性评估</li>
</ul>
<h3 id="_19">量产考虑</h3>
<h4 id="_20">良率优化</h4>
<ul>
<li>[ ] 工艺偏差分析</li>
<li>[ ] 蒙特卡洛仿真</li>
<li>[ ] 校准算法鲁棒性</li>
<li>[ ] 测试覆盖率</li>
<li>[ ] 失效模式分析</li>
</ul>
<h4 id="_21">成本控制</h4>
<ul>
<li>[ ] 面积优化</li>
<li>[ ] 测试时间最小化</li>
<li>[ ] 校准复杂度平衡</li>
<li>[ ] 功耗规格满足</li>
<li>[ ] 封装选择优化</li>
</ul>
<p>通过系统的检查清单，确保读出电路设计的完整性和可靠性，避免后期返工，提高一次成功率。</p>
            </article>
            
            <nav class="page-nav"><a href="chapter4.html" class="nav-link prev">← 第4章：像素架构演进</a><a href="chapter6.html" class="nav-link next">第6章：时序控制与接口电路 →</a></nav>
        </main>
    </div>
</body>
</html>